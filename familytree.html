<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <title>Bible Family Tree — Mobile</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Mobile-only gate: gently nudge desktop users */
    @media (min-width: 768px) {
      #mobile-app { display:none; }
      #desktop-blocker { display:flex; }
    }
    /* Make the canvas area fill the screen */
    html, body { height:100%; }
    body { background:#0b1220; }
    .hide-scrollbar::-webkit-scrollbar{ display:none; }
    .hide-scrollbar{ -ms-overflow-style:none; scrollbar-width:none; }

    /* Edge routing for links */
    .edge { stroke:#7aa2ff; stroke-opacity:.5; stroke-width:2; fill:none; }

    /* Simple tap ripple */
    .ripple { position:relative; overflow:hidden; }
    .ripple:after {
      content:"";
      position:absolute; inset:auto;
      width:0; height:0; border-radius:9999px;
      background:rgba(255,255,255,.25); transform:translate(-50%, -50%);
      transition:width .35s ease, height .35s ease, opacity .5s ease;
      pointer-events:none;
    }
    .ripple:active:after { width:220px; height:220px; opacity:0; }
  </style>
</head>
<body class="text-slate-100 selection:bg-indigo-300 selection:text-slate-900">

  <!-- Desktop blocker -->
  <section id="desktop-blocker" class="hidden fixed inset-0 items-center justify-center p-8 bg-slate-900 text-slate-200">
    <div class="max-w-md text-center space-y-4">
      <h1 class="text-2xl font-semibold">This app is designed for mobile</h1>
      <p class="opacity-80">Open it on your phone or use your browser’s mobile preview. (You can remove this gate if you want it responsive.)</p>
    </div>
  </section>

  <!-- App -->
  <section id="mobile-app" class="flex flex-col h-full">
    <!-- Top Bar -->
    <header class="shrink-0 px-4 pt-4 pb-3 bg-gradient-to-b from-slate-900 to-slate-800/60 backdrop-blur">
      <div class="flex items-center gap-3">
        <div class="size-9 rounded-xl bg-indigo-500 grid place-items-center shadow-md shadow-indigo-900/40">
          <span class="text-sm font-bold">FT</span>
        </div>
        <div class="flex-1">
          <h1 class="text-lg font-semibold leading-tight">Bible Character Family Tree</h1>
          <p class="text-xs text-slate-300">Pan, zoom, and tap a name to learn more</p>
        </div>
        <button id="infoBtn" class="ripple text-xs px-3 py-2 rounded-lg bg-slate-700/60">About</button>
      </div>

      <!-- Search -->
      <div class="mt-3">
        <label class="sr-only" for="search">Search characters</label>
        <div class="flex items-center gap-2">
          <div class="flex-1 relative">
            <input id="search" type="text" inputmode="search" placeholder="Search: Adam, Noah, Abraham, David, Jesus..."
                   class="w-full rounded-xl bg-slate-800/80 px-4 py-3 pr-10 outline-none ring-1 ring-slate-700 focus:ring-indigo-400 text-sm" />
            <svg class="absolute right-3 top-1/2 -translate-y-1/2 size-5 opacity-70" viewBox="0 0 24 24" fill="none">
              <path d="m21 21-4.3-4.3M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="currentColor" stroke-width="1.5"/>
            </svg>
          </div>
          <div class="flex gap-2">
            <button id="zoomOut" class="ripple px-3 py-2 rounded-lg bg-slate-800 ring-1 ring-slate-700">−</button>
            <button id="zoomIn" class="ripple px-3 py-2 rounded-lg bg-slate-800 ring-1 ring-slate-700">+</button>
            <button id="fitBtn" class="ripple px-3 py-2 rounded-lg bg-slate-800 ring-1 ring-slate-700">Fit</button>
          </div>
        </div>
      </div>
    </header>

    <!-- Canvas -->
    <main class="grow relative">
      <div id="canvasWrap" class="absolute inset-0 overflow-hidden touch-pan-y hide-scrollbar">
        <svg id="svg" class="w-full h-full block" xmlns="http://www.w3.org/2000/svg">
          <!-- zoomable world -->
          <g id="world">
            <g id="edges"></g>
            <g id="nodes"></g>
          </g>
        </svg>
      </div>
    </main>

    <!-- Bottom Sheet -->
    <section id="sheet" class="pointer-events-none fixed inset-x-0 bottom-0 z-10 translate-y-full transition-transform duration-300">
      <div class="pointer-events-auto rounded-t-2xl bg-slate-900/95 border-t border-slate-700 shadow-[0_-20px_60px_rgba(0,0,0,0.35)] p-4">
        <div class="mx-auto max-w-md">
          <div class="flex items-start gap-3">
            <div id="sheetAvatar" class="size-10 shrink-0 rounded-xl bg-indigo-500/80 grid place-items-center shadow-inner">
              <span class="text-sm font-bold">—</span>
            </div>
            <div class="flex-1">
              <h3 id="sheetTitle" class="text-base font-semibold">Name</h3>
              <p id="sheetSub" class="text-xs text-slate-300"></p>
            </div>
            <button id="closeSheet" class="ripple rounded-lg px-3 py-2 bg-slate-800">Close</button>
          </div>
          <div id="sheetBody" class="mt-3 text-sm leading-6 text-slate-200"></div>
        </div>
      </div>
    </section>

    <!-- About Modal (simple sheet reuse) -->
  </section>

  <script>
    // -------- Data (compact demo set; you can extend easily) --------
    // Each node: id, name, gender, blurb (1–2 sentences), parents[], children[], collapsed?
    const NODES = [
      { id:"adam", name:"Adam", gender:"m",
        blurb:"According to Genesis, the first man. Father of Cain, Abel, and Seth.",
        children:["cain","abel","seth"], collapsed:false
      },
      { id:"eve", name:"Eve", gender:"f",
        blurb:"The first woman; mother of all living. Partner of Adam.",
        children:["cain","abel","seth"], collapsed:false
      },

      { id:"cain", name:"Cain", gender:"m",
        blurb:"Eldest son of Adam and Eve. Known for killing his brother Abel.",
        parents:["adam","eve"], children:[], collapsed:true
      },
      { id:"abel", name:"Abel", gender:"m",
        blurb:"Second son of Adam and Eve; a shepherd whose offering pleased the LORD.",
        parents:["adam","eve"], children:[], collapsed:true
      },
      { id:"seth", name:"Seth", gender:"m",
        blurb:"Son of Adam and Eve given after Abel; from his line comes Noah.",
        parents:["adam","eve"], children:["enos"], collapsed:false
      },
      { id:"enos", name:"Enosh", gender:"m",
        blurb:"Grandson of Adam through Seth. In his days people began to call on the LORD.",
        parents:["seth"], children:["noah_ancestor"], collapsed:true
      },

      // Compressing intermediate generations into one placeholder to keep the mobile view readable.
      { id:"noah_ancestor", name:"(Generations)", gender:"m",
        blurb:"Many generations between Enosh and Noah (Genesis 5) are summarized here to keep the tree compact.",
        parents:["enos"], children:["noah"], collapsed:false
      },

      { id:"noah", name:"Noah", gender:"m",
        blurb:"Builder of the ark; preserved through the flood. Father of Shem, Ham, and Japheth.",
        parents:["noah_ancestor"], children:["shem","ham","japheth"], collapsed:false
      },
      { id:"shem", name:"Shem", gender:"m",
        blurb:"Son of Noah; ancestral line leading to Abraham.",
        parents:["noah"], children:["abraham_ancestor"], collapsed:false
      },
      { id:"ham", name:"Ham", gender:"m",
        blurb:"Son of Noah; ancestor of various nations.",
        parents:["noah"], children:[], collapsed:true
      },
      { id:"japheth", name:"Japheth", gender:"m",
        blurb:"Son of Noah; ancestor of many coastland peoples.",
        parents:["noah"], children:[], collapsed:true
      },

      { id:"abraham_ancestor", name:"(Generations)", gender:"m",
        blurb:"Several generations (Genesis 11) between Shem and Abram are summarized for clarity on mobile.",
        parents:["shem"], children:["abraham"], collapsed:false
      },

      { id:"abraham", name:"Abraham", gender:"m",
        blurb:"Called by God; covenant bearer. Father of Ishmael and Isaac.",
        parents:["abraham_ancestor"], children:["ishmael","isaac"], collapsed:false
      },
      { id:"sarah", name:"Sarah", gender:"f",
        blurb:"Wife of Abraham; mother of Isaac.",
        children:["isaac"], collapsed:true
      },
      { id:"hagar", name:"Hagar", gender:"f",
        blurb:"Egyptian servant of Sarah; mother of Ishmael.",
        children:["ishmael"], collapsed:true
      },
      { id:"ishmael", name:"Ishmael", gender:"m",
        blurb:"Son of Abraham; ancestor of many nations.",
        parents:["abraham","hagar"], children:[], collapsed:true
      },
      { id:"isaac", name:"Isaac", gender:"m",
        blurb:"Son of Abraham and Sarah; father of Esau and Jacob.",
        parents:["abraham","sarah"], children:["esau","jacob"], collapsed:false
      },
      { id:"rebekah", name:"Rebekah", gender:"f",
        blurb:"Wife of Isaac; mother of Esau and Jacob.",
        children:["esau","jacob"], collapsed:true
      },
      { id:"esau", name:"Esau", gender:"m",
        blurb:"Elder twin of Jacob; ancestor of Edom.",
        parents:["isaac","rebekah"], children:[], collapsed:true
      },
      { id:"jacob", name:"Jacob (Israel)", gender:"m",
        blurb:"Son of Isaac; renamed Israel. Father of the twelve tribes.",
        parents:["isaac","rebekah"], children:["judah","joseph","levi","reuben","simeon","issachar","zebulun","dan","naphtali","gad","asher","benjamin"], collapsed:false
      },

      { id:"judah", name:"Judah", gender:"m",
        blurb:"Fourth son of Jacob; royal line leading to David.",
        parents:["jacob"], children:["david_ancestor"], collapsed:false
      },
      { id:"joseph", name:"Joseph", gender:"m",
        blurb:"Son of Jacob; rose to power in Egypt and preserved his family.",
        parents:["jacob"], children:[], collapsed:true
      },
      { id:"levi", name:"Levi", gender:"m", blurb:"Tribe of priests descends from him.", parents:["jacob"], children:[], collapsed:true },
      { id:"reuben", name:"Reuben", gender:"m", blurb:"Firstborn of Jacob.", parents:["jacob"], children:[], collapsed:true },
      { id:"simeon", name:"Simeon", gender:"m", blurb:"Second son of Jacob.", parents:["jacob"], children:[], collapsed:true },
      { id:"issachar", name:"Issachar", gender:"m", blurb:"One of Jacob’s sons.", parents:["jacob"], children:[], collapsed:true },
      { id:"zebulun", name:"Zebulun", gender:"m", blurb:"One of Jacob’s sons.", parents:["jacob"], children:[], collapsed:true },
      { id:"dan", name:"Dan", gender:"m", blurb:"One of Jacob’s sons.", parents:["jacob"], children:[], collapsed:true },
      { id:"naphtali", name:"Naphtali", gender:"m", blurb:"One of Jacob’s sons.", parents:["jacob"], children:[], collapsed:true },
      { id:"gad", name:"Gad", gender:"m", blurb:"One of Jacob’s sons.", parents:["jacob"], children:[], collapsed:true },
      { id:"asher", name:"Asher", gender:"m", blurb:"One of Jacob’s sons.", parents:["jacob"], children:[], collapsed:true },
      { id:"benjamin", name:"Benjamin", gender:"m", blurb:"Youngest son of Jacob.", parents:["jacob"], children:[], collapsed:true },

      { id:"david_ancestor", name:"(Generations)", gender:"m",
        blurb:"Generations from Judah to David (Ruth 4, 1 Chronicles) summarized.",
        parents:["judah"], children:["david"], collapsed:false
      },
      { id:"david", name:"David", gender:"m",
        blurb:"King of Israel; the shepherd poet from Bethlehem.",
        parents:["david_ancestor"], children:["jesus_ancestor"], collapsed:false
      },

      { id:"jesus_ancestor", name:"(Generations)", gender:"m",
        blurb:"Generations from David to Jesus (Matthew 1; Luke 3) summarized for mobile clarity.",
        parents:["david"], children:["mary","joseph"], collapsed:false
      },
      { id:"mary", name:"Mary", gender:"f",
        blurb:"Mother of Jesus.",
        parents:["jesus_ancestor"], children:["jesus"], collapsed:false
      },
      { id:"joseph", name:"Joseph (of Nazareth)", gender:"m",
        blurb:"Legal father of Jesus; descendant of David.",
        parents:["jesus_ancestor"], children:["jesus"], collapsed:true
      },
      { id:"jesus", name:"Jesus", gender:"m",
        blurb:"Central figure of the New Testament; believed by Christians to be the Messiah.",
        parents:["mary","joseph"], children:[], collapsed:true
      },
    ];

    // Build lookup
    const byId = Object.fromEntries(NODES.map(n => [n.id, n]));

    // -------- Layout (simple vertical layered layout for mobile) --------
    // We compute "generation" depth from Adam → down primary lines.
    function computeGenerations() {
      const depth = {};
      const roots = NODES.filter(n => !n.parents || n.parents.length === 0 || n.id === "adam" || n.id==="eve");
      const q = [];
      roots.forEach(r => { depth[r.id] = 0; q.push(r.id); });

      while (q.length) {
        const cur = q.shift();
        const d = depth[cur];
        const node = byId[cur];
        (node.children||[]).forEach(ch => {
          if (depth[ch] == null || depth[ch] > d+1) {
            depth[ch] = d + 1;
            q.push(ch);
          }
        });
      }
      return depth;
    }

    const depth = computeGenerations();

    // Distribute nodes per generation for initial x-order
    function generationsToRows() {
      const rows = {};
      for (const n of NODES) {
        const d = depth[n.id] ?? 0;
        (rows[d] ||= []).push(n);
      }
      // sort rows for nicer order (keep key figures left)
      Object.values(rows).forEach(arr => {
        arr.sort((a,b) => {
          const keyOrder = ["adam","eve","seth","noah","shem","abraham","isaac","jacob","judah","david","mary","joseph","jesus"];
          const pa = keyOrder.indexOf(a.id); const pb = keyOrder.indexOf(b.id);
          if (pa!==-1 || pb!==-1) return (pa===-1?999:pa)-(pb===-1?999:pb);
          return a.name.localeCompare(b.name);
        });
      });
      return rows;
    }

    // Node box sizes
    const NODE_W = 160, NODE_H = 60, ROW_GAP = 90, COL_GAP = 18;
    const PADDING = 60;

    function computePositions() {
      const rows = generationsToRows();
      const positions = {};
      const depths = Object.keys(rows).map(k=>+k).sort((a,b)=>a-b);
      let width = 0, height = 0;

      depths.forEach((d, i) => {
        const arr = rows[d];
        const totalWidth = arr.length*NODE_W + (arr.length-1)*COL_GAP;
        width = Math.max(width, totalWidth);
        const y = PADDING + i*(NODE_H + ROW_GAP);
        arr.forEach((n, idx) => {
          const x = PADDING + idx*(NODE_W + COL_GAP);
          positions[n.id] = {x, y, d};
        });
      });
      height = PADDING*2 + depths.length*(NODE_H + ROW_GAP);
      width += PADDING*2;
      return {positions, width, height};
    }

    // -------- Rendering --------
    const svg = document.getElementById('svg');
    const gWorld = document.getElementById('world');
    const gEdges = document.getElementById('edges');
    const gNodes = document.getElementById('nodes');

    let world = { scale: 0.9, tx: 0, ty: 0 };
    function applyTransform() {
      gWorld.setAttribute('transform', `translate(${world.tx},${world.ty}) scale(${world.scale})`);
    }

    function draw() {
      const {positions, width, height} = computePositions();
      svg.setAttribute('viewBox', `0 0 ${width} ${height}`);

      // Edges
      gEdges.innerHTML = "";
      NODES.forEach(n => {
        const p = positions[n.id]; if (!p) return;
        (n.children||[]).forEach(chId => {
          const c = positions[chId]; if (!c) return;
          // simple elbow path
          const x1 = p.x + NODE_W/2, y1 = p.y + NODE_H;
          const x2 = c.x + NODE_W/2, y2 = c.y;
          const midY = (y1 + y2)/2;
          const path = `M ${x1} ${y1} L ${x1} ${midY} L ${x2} ${midY} L ${x2} ${y2}`;
          const el = document.createElementNS("http://www.w3.org/2000/svg","path");
          el.setAttribute('d', path);
          el.setAttribute('class','edge');
          gEdges.appendChild(el);
        });
      });

      // Nodes
      gNodes.innerHTML = "";
      NODES.forEach(n => {
        const pos = positions[n.id]; if (!pos) return;

        const group = document.createElementNS("http://www.w3.org/2000/svg","g");
        group.setAttribute('transform', `translate(${pos.x},${pos.y})`);
        group.setAttribute('data-id', n.id);
        group.style.cursor = 'pointer';

        // Card background
        const rect = document.createElementNS("http://www.w3.org/2000/svg","rect");
        rect.setAttribute('rx', 14);
        rect.setAttribute('width', NODE_W);
        rect.setAttribute('height', NODE_H);
        rect.setAttribute('fill', n.gender === 'f' ? 'url(#gradF)' : 'url(#gradM)');
        rect.setAttribute('stroke', 'rgba(255,255,255,0.12)');
        rect.setAttribute('stroke-width', '1');

        // Name
        const name = document.createElementNS("http://www.w3.org/2000/svg","text");
        name.setAttribute('x', 14);
        name.setAttribute('y', 26);
        name.setAttribute('font-size', '14');
        name.setAttribute('font-weight', '700');
        name.setAttribute('fill', '#e6ecff');
        name.textContent = n.name;

        // Mini blurb line (truncated)
        const sub = document.createElementNS("http://www.w3.org/2000/svg","text");
        sub.setAttribute('x', 14);
        sub.setAttribute('y', 44);
        sub.setAttribute('font-size', '11.5');
        sub.setAttribute('fill', '#c6d0f7');
        const short = n.blurb.length > 48 ? n.blurb.slice(0,45)+'…' : n.blurb;
        sub.textContent = short;

        // Expand icon if children
        if ((n.children||[]).length) {
          const ico = document.createElementNS("http://www.w3.org/2000/svg","text");
          ico.setAttribute('x', NODE_W-18);
          ico.setAttribute('y', 22);
          ico.setAttribute('font-size','16');
          ico.setAttribute('fill','#dbe4ff');
          ico.textContent = '⤵';
          group.appendChild(ico);
        }

        group.appendChild(rect);
        group.appendChild(name);
        group.appendChild(sub);

        // Events
        group.addEventListener('click', () => openSheet(n));
        gNodes.appendChild(group);
      });

      // Gradients (one-time)
      ensureDefs();
    }

    function ensureDefs() {
      if (document.getElementById('defs')) return;
      const defs = document.createElementNS("http://www.w3.org/2000/svg","defs");
      defs.setAttribute('id','defs');
      defs.innerHTML = `
        <linearGradient id="gradM" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0%" stop-color="#1c2a4a"/>
          <stop offset="100%" stop-color="#0f172a"/>
        </linearGradient>
        <linearGradient id="gradF" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0%" stop-color="#2a1c4a"/>
          <stop offset="100%" stop-color="#0f172a"/>
        </linearGradient>
      `;
      svg.prepend(defs);
    }

    // -------- Bottom sheet --------
    const sheet = document.getElementById('sheet');
    const sheetTitle = document.getElementById('sheetTitle');
    const sheetSub = document.getElementById('sheetSub');
    const sheetBody = document.getElementById('sheetBody');
    const sheetAvatar = document.getElementById('sheetAvatar');
    const closeSheetBtn = document.getElementById('closeSheet');

    function openSheet(node) {
      sheetTitle.textContent = node.name;
      sheetSub.textContent = (node.parents?.length ? "Parents: " + node.parents.map(id=>byId[id]?.name||id).join(", ") : "—");
      sheetBody.textContent = node.blurb;
      sheetAvatar.querySelector('span').textContent = node.name.slice(0,1);
      sheet.style.transform = 'translateY(0%)';
    }
    closeSheetBtn.addEventListener('click', () => {
      sheet.style.transform = 'translateY(100%)';
    });

    // -------- Pan & Zoom (touch-friendly) --------
    const wrap = document.getElementById('canvasWrap');
    let isPanning=false, lastX=0,lastY=0;

    wrap.addEventListener('pointerdown', (e)=>{
      isPanning = true; lastX = e.clientX; lastY = e.clientY; wrap.setPointerCapture(e.pointerId);
    });
    wrap.addEventListener('pointermove', (e)=>{
      if (!isPanning) return;
      const dx = e.clientX - lastX, dy = e.clientY - lastY;
      world.tx += dx; world.ty += dy; lastX = e.clientX; lastY = e.clientY; applyTransform();
    });
    wrap.addEventListener('pointerup', ()=>{ isPanning=false; });
    wrap.addEventListener('pointercancel', ()=>{ isPanning=false; });

    // Simple wheel zoom for mobile trackpads (no pinch here to keep code light)
    wrap.addEventListener('wheel', (e)=>{
      e.preventDefault();
      const delta = Math.sign(e.deltaY);
      const factor = delta>0 ? 0.9 : 1.1;
      world.scale = clamp(world.scale*factor, 0.5, 1.8);
      applyTransform();
    }, {passive:false});

    function clamp(v,min,max){ return Math.max(min, Math.min(max,v)); }

    document.getElementById('zoomIn').addEventListener('click', ()=>{
      world.scale = clamp(world.scale*1.15, 0.5, 1.8); applyTransform();
    });
    document.getElementById('zoomOut').addEventListener('click', ()=>{
      world.scale = clamp(world.scale/1.15, 0.5, 1.8); applyTransform();
    });

    document.getElementById('fitBtn').addEventListener('click', fitToScreen);

    function fitToScreen() {
      // center roughly (simple heuristic)
      world.scale = 0.85; world.tx = 10; world.ty = 10; applyTransform();
    }

    // -------- Search --------
    const search = document.getElementById('search');
    let searchTimer = null;
    search.addEventListener('input', ()=>{
      clearTimeout(searchTimer);
      searchTimer = setTimeout(()=>{
        const q = search.value.trim().toLowerCase();
        if (!q) return;
        const match = NODES.find(n => n.name.toLowerCase().includes(q));
        if (match) { openSheet(match); highlightNode(match.id); }
      }, 200);
    });

    function highlightNode(id) {
      // Brief glow by drawing an overlay rect
      const nodeEl = [...gNodes.children].find(g=>g.getAttribute('data-id')===id);
      if (!nodeEl) return;
      const rect = nodeEl.querySelector('rect');
      const orig = rect.getAttribute('filter');
      rect.setAttribute('filter','url(#glow)');
      ensureGlow();
      setTimeout(()=> rect.setAttribute('filter', orig||''), 1200);
    }
    function ensureGlow() {
      if (document.getElementById('glow')) return;
      const defs = document.getElementById('defs');
      const f = document.createElementNS("http://www.w3.org/2000/svg","filter");
      f.setAttribute('id','glow');
      f.innerHTML = `
        <feGaussianBlur stdDeviation="3.5" result="blur"/>
        <feMerge>
          <feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/>
        </feMerge>
      `;
      defs.appendChild(f);
    }

    // -------- About --------
    document.getElementById('infoBtn').addEventListener('click', ()=>{
      openSheet({
        name:"About this tree",
        blurb:"A compact, mobile-friendly view focusing on a key lineage (Adam → Seth → Noah → Shem → Abraham → Isaac → Jacob → Judah → David → Jesus). Some generations are summarized so it stays readable on phones. You can expand this dataset in code to include more people.",
        parents:[]
      });
    });

    // -------- Init --------
    draw();
    fitToScreen();

    // You can extend the dataset: add nodes to NODES with parents/children, then call draw() again.
    // For GitHub Pages, this single file is enough.
  </script>
</body>
</html>
